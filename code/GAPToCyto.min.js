const letters=[...Array(26).keys()].map(i=>String.fromCharCode(97+i));var QuiverData,cy,Relations;function infLetters(i){var res=letters[i%26];return res+=Array(parseInt(i/26+1)).fill("").reduce((prev,curr)=>prev+"^")}const primes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61],gens=[1,2,2,3,2,2,3,2,5,2,3,2,6,3,5,2,2,2];function isPowerOfPrime(x){for(let p of primes){if(x==p)return[p,1];let logp=Math.log(x)/Math.log(p);if(logp%1==0)return[p,logp]}return console.log(`Cannot find ${x} as a power of prime less than 62`),[0,0]}function findFieldChar(str){return"Z"==str[1]?isPowerOfPrime(parseInt(str.slice(3,str.indexOf(")"))))[0]:0}function getCpxNum(str){return-1!=str.indexOf("/")?str:-1!=str.indexOf(".")?str:-1!=str.indexOf("i")?str:-1!=str.indexOf("(")?str.slice(1,-1):str}function translateScalar(a,char){if(-1==char)return a;if(0==char){var res=getCpxNum(a);return"("!=res[0]?"1"==res?"":"-1"==res?"-":res:res}var hasExpo=a.indexOf("^"),expo=-1!=hasExpo?a.slice(hasExpo+1,-1):1;if(0==expo)return"";var result=Math.pow(gens[primes.indexOf(char)],expo);return result==char-1?"-":result}function translateQPA(){var quiverIn=document.getElementById("inQuiver").value;quiverIn="["+(quiverIn=(quiverIn=(quiverIn=quiverIn.replace(/(\\\r\n|\\\r|\\\n)/g,"")).replace(/;/g,"")).replace(/^(\s*)Quiver(\(*)/,"")).replace(/\)(\s*)$/,"")+"]";var quiverQPA=JSON.parse(quiverIn);if(quiverQPA[0].length>25)return document.getElementById("outTxtBox").innerHTML="<span style='color:red; font-size: 20pt'>More than 25 vertices! Abort translation.</span>",void clearAll();var forceID=document.getElementById("forceID").checked,vxQPA,vx,arr;const quiverData={nodes:quiverQPA[0].map((v,i)=>forceID?i+1:v.replace(/"/g,"")).map(v=>({data:{id:v}})),edges:quiverQPA[1].map((function(ar,i){var idlabel=document.getElementById("forceArrow").checked?infLetters(i):ar[2],core;return{data:{id:idlabel,source:forceID?quiverQPA[0].indexOf(ar[0])+1:ar[0],target:forceID?quiverQPA[0].indexOf(ar[1])+1:ar[1],label:idlabel}}}))};var relns=[],arrRelns=document.getElementById("inRelation").value.replace(/[\s\[\]]/g,"").split(","),arrRef=quiverQPA[1].map(entry=>entry[2]),charFound=-1,relData=[];for(let rel of arrRelns){let readIndex=0,monomials=rel.split(/[\+-]/),newRel="",reldataentry=Array(monomials.length).fill({scalar:1,monomial:[]});for(let i=0;i<monomials.length;i++){let[scalar,...arrs]=monomials[i].split("*");charFound=-1==charFound?findFieldChar(scalar):charFound,document.getElementById("controlOutput").innerHTML=`Detected characteristic as ${-1!=charFound?charFound:"unknown"}.`,scalar=translateScalar(scalar,charFound),reldataentry[i].scalar=scalar;let newMono=arrs.map(x=>{let q=arrRef.indexOf(x),arr=-1!=q&&document.getElementById("forceArrow").checked?infLetters(q):x;return reldataentry[i].monomial.push(arr),arr}).join("·");readIndex+=monomials[i].length,newMono+=i+1==monomials.length?"":rel[readIndex],newRel+=""==scalar?newMono:"-"==scalar?`-${newMono}`:`${scalar}·${newMono}`,readIndex++}relData.push(reldataentry),relns.push(newRel)}relns=relns.join(", "),document.getElementById("sysOutput").innerHTML=`Relations: ${relns}`,document.getElementById("fixCyto").disabled=!1,QuiverData=quiverData,console.log("quiverData from translateQPA(): ",quiverData),initCyto(quiverData)}function initCyto(inputData){return console.log(inputData),console.log(testdata),cytoscape({container:document.getElementById("cy"),elements:inputData,style:[{selector:"node",css:{width:25,height:25,shape:"ellipse","background-color":"#ffffff","border-width":"1px","border-style":"solid","border-color":"#000",content:"data(id)","text-valign":"center","text-halign":"center"}},{selector:"node:selected",style:{"background-color":"#fa5252",width:30,height:30}},{selector:"edge",style:{width:2,"line-color":"#000","target-arrow-color":"#000","target-arrow-shape":"triangle","curve-style":"bezier","loop-direction":"0deg","loop-sweep":"45deg"}},{selector:"edge[label]",style:{label:"data(label)",color:"#0AA","text-outline-color":"#DD0","text-outline-width":1}}],layout:{name:"breadthfirst",fit:!0,padding:20,nodeDimensionsIncludeLabels:!0},selectionType:"single",userZoomingEnabled:!0,userPanningEnabled:!0,wheelSensitivity:.5,pan:{x:40,y:40}})}function clearAll(){document.getElementById("inQuiver").value="",document.getElementById("inRelation").value="",document.getElementById("fixCyto").disabled=!0}document.getElementById("fixCyto").addEventListener("click",()=>cy.fit()),document.getElementById("translateBtn").addEventListener("click",()=>translateQPA());